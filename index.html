<!DOCTYPE html>
<html>
<head lang="fr">
    <meta charset="UTF-8">
    <title>Demo WebGIS</title>
    <!-- Library Leaflet -->
    <link rel="stylesheet" href="leaflet/leaflet.css" />
    <script src="leaflet/leaflet.js"></script>

    <!-- Extension GÃ©oportail pour Leaflet -->
    <script src="GpPluginLeaflet/GpPluginLeaflet.js"></script>
    <link rel="stylesheet" href="GpPluginLeaflet/GpPluginLeaflet.css" />

    <!-- TileLayer BetterWMS -->
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="js/L.TileLayer.BetterWMS.js"></script>

    <!-- jsonQ - http://ignitersworld.com/lab/jsonQ.html -->
    <script src="js/jsonQ.min.js"></script>
    <style>
        #map {
            padding: 5px;
            width: 100%;
            height: 600px;
            box-shadow: 0 0 10px #999;
        }

        #info {
            padding: 5px;
            width: 100%;
            height: 20px;
            font-family: monospace;
        }
    </style>
    <script>
        function go() {
            map = L.map("map").setView([48.845, 2.424], 5);
            // var lyrOSM= L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png') ;

            var lyrOSM = L.geoportalLayer.WMTS({
                layer: "GEOGRAPHICALGRIDSYSTEMS.MAPS",
            }, { // leafletParams
                opacity: 1
            });

            var url = 'http://localhost:8080/geoserver/ign/wms';
            var lyrCommune = L.tileLayer.betterWms(url, {
                layers: "ign:infos_map_view",
                format: 'image/png',
                opacity: 0.7,
                info_format: 'application/json', // Return with JSON format
                transparent: true
            });

           /* var lyrChef = L.tileLayer.betterWms(url, {
                layers: "ign:fr-chef_lieu",
                format: 'image/png',
                opacity: 0.5,
                info_format: 'application/json', // Return with JSON format
                transparent: true
            });*/

            // Make makers by Json
            /*var myIcon = L.icon({
                iconUrl: 'images/pin24.png',
                iconRetinaUrl: 'images/pin48.png',
                iconSize: [29, 24],
                iconAnchor: [9, 21],
                popupAnchor: [0, -14]
            })

            for ( var i=0; i < markers.length; ++i )
            {
                L.marker( [markers[i].lat, markers[i].lng], {icon: myIcon} )
                    .bindPopup( '<a href="' + markers[i].url + '" target="_blank">' + markers[i].name + '</a>' )
                    .addTo( map );
            }*/

            map.addLayer(lyrOSM);
            map.addLayer(lyrCommune);
            //map.addLayer(lyrChef);

            var layerSwitcher = L.geoportalControl.LayerSwitcher({
                layers : [{
                    layer : lyrOSM,
                    config : {
                        title : "OSM",
                        description : "Couche Open Street Maps"
                    }
                    },
                    {
                        layer : lyrCommune,
                        config : {
                            title : "Commune",
                            description : "Commune on Open Street Maps"
                        }
                    }]
            });
            map.addControl(layerSwitcher);

            var mpCtrl = L.geoportalControl.MousePosition({});
            map.addControl(mpCtrl);

            // Search Bar
            var searchCtrl = L.geoportalControl.SearchEngine({zoomTo : "auto"});
            map.addControl(searchCtrl);
            // Router
            var routeCtrl = L.geoportalControl.Route({});
            map.addControl(routeCtrl);
        }

        Gp.Services.getConfig({
            apiKey : "jhyvi0fgmnuxvfv0zjzorvdn",
            onSuccess : go
        }) ;
    </script>
</head>

<body>
    <div id="map"></div>
    <div id="info"></div>
    <!--<script type='text/javascript' src='json/markers.json'></script>-->
</body>
</html>